# 比特币密钥与交易签名验证工具集 - math_util.py

## 模块概述
提供比特币密钥管理、交易签名及验证的核心功能，包含密钥生成、地址派生、P2PKH脚本处理等完整流程。  
**代码定位**：教育演示用途（非生产环境），展示比特币底层技术原理。

---

## 核心功能

### 1. 密钥生成工具 (`GenerateKeysUtils`)
| 方法                          | 功能               | 关键实现                                  |
| ----------------------------- | ------------------ | ----------------------------------------- |
| `generate_private_key()`      | 生成32字节随机私钥 | `os.urandom(32)`                          |
| `private_key_to_public_key()` | 私钥→压缩公钥      | SECP256k1曲线计算，前缀02/03标识y坐标奇偶 |
| `public_key_to_address()`     | 公钥→比特币地址    | SHA256+RIPEMD160哈希 → Base58Check编码    |
| `hash160()`                   | 双重哈希计算       | SHA256 → RIPEMD160                        |
| `uncompressed_public_key()`   | 压缩公钥解压       | 椭圆曲线数学运算恢复完整坐标              |

**安全警告**：  
⚠️ 示例代码内存存储私钥，实际应用需硬件级安全保护

---

### 2. 交易签名工具 (`SignMessageUtils`)
| 方法                 | 功能          | 技术要点                       |
| -------------------- | ------------- | ------------------------------ |
| `sign_transaction()` | ECDSA交易签名 | RFC 6979确定性签名，SHA256哈希 |

**签名流程**：  
`私钥(bytes)` + `交易数据(bytes)` → `DER编码签名(bytes)`

---

### 3. 验证工具集 (`VerifyHashAndSignatureUtils`)
| 方法                    | 功能           | 验证逻辑                                                     |
| ----------------------- | -------------- | ------------------------------------------------------------ |
| `unlock_p2pkh_script()` | P2PKH脚本解锁  | 1. 解析锁定脚本<br>2. 校验公钥哈希<br>3. 构建`<signature> <pubKey>`解锁脚本 |
| `verify_signature()`    | 签名有效性验证 | 自动处理压缩/非压缩公钥，ECDSA验证                           |

**P2PKH验证流程**：  

解锁脚本: <签名> <公钥>
锁定脚本: OP_DUP OP_HASH160 <公钥哈希> OP_EQUALVERIFY OP_CHECKSIG